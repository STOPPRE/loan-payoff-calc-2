<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Loan Payoff Calculator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8f9fa; /* Light gray background */
        }
        .slider-thumb::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: #3b82f6; /* Blue-500 */
            cursor: pointer;
            border-radius: 50%;
        }
        .slider-thumb::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: #3b82f6; /* Blue-500 */
            cursor: pointer;
            border-radius: 50%;
        }
        .card {
            background-color: white;
            border-radius: 1rem; /* 16px */
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            padding: 1.5rem; /* 24px */
        }
    </style>
</head>
<body class="text-gray-800">

    <div class="container mx-auto p-4 md:p-8 max-w-4xl">
        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-800">Loan Payoff Visualizer</h1>
            <p class="text-gray-600 mt-2">See how your payments chip away at a loan over time.</p>
        </header>

        <!-- Main Content Card -->
        <div class="card">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <!-- Input Form -->
                <div id="loan-form">
                    <h2 class="text-2xl font-semibold mb-4 text-gray-700">Loan Details</h2>
                    <div class="space-y-4">
                        <div>
                            <label for="loanAmount" class="block text-sm font-medium text-gray-700">Loan Amount ($)</label>
                            <input type="number" id="loanAmount" value="25000" placeholder="e.g., 25000" class="mt-1 block w-full px-3 py-2 bg-gray-50 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div>
                            <label for="interestRate" class="block text-sm font-medium text-gray-700">Annual Interest Rate (%)</label>
                            <input type="number" id="interestRate" value="5" step="0.1" placeholder="e.g., 5" class="mt-1 block w-full px-3 py-2 bg-gray-50 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div>
                            <label for="loanTerm" class="block text-sm font-medium text-gray-700">Loan Term (Years)</label>
                            <input type="number" id="loanTerm" value="5" placeholder="e.g., 5" class="mt-1 block w-full px-3 py-2 bg-gray-50 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        </div>
                    </div>
                     <button id="calculateBtn" class="mt-6 w-full bg-blue-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors">
                        Calculate & Visualize
                    </button>
                </div>

                <!-- Chart & Monthly Payment -->
                <div class="flex flex-col justify-center h-full">
                     <div class="relative w-full h-full min-h-[250px] md:min-h-0">
                        <canvas id="payoffChart"></canvas>
                    </div>
                     <div class="text-center mt-4 w-full">
                        <p class="text-base text-gray-600">Monthly Payment</p>
                        <p id="monthlyPayment" class="text-3xl font-bold text-gray-800">$0.00</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tabs Section -->
        <div class="mt-8">
            <!-- Tab Headers -->
            <div class="border-b border-gray-200">
                <nav class="-mb-px flex space-x-8" aria-label="Tabs">
                    <button id="resultsTabBtn" type="button" class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm border-blue-500 text-blue-600">
                        Results
                    </button>
                    <button id="scheduleTabBtn" type="button" class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300">
                        Amortization Schedule
                    </button>
                </nav>
            </div>

            <!-- Tab Content -->
            <div class="mt-6">
                <!-- Results Content Panel -->
                <div id="resultsContent" class="tab-content card">
                    <!-- Time Slider -->
                    <div id="slider-container" class="mb-6 hidden">
                        <label for="paymentSlider" class="block text-sm font-medium text-gray-700">Payment Month: <span id="sliderValue" class="font-bold text-blue-600">1</span></label>
                        <input type="range" id="paymentSlider" min="1" max="60" value="1" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer slider-thumb mt-2">
                    </div>
                    
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">Summary for Selected Month</h3>
                    <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 text-center">
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <p class="text-sm text-gray-600">Principal This Month</p>
                            <p id="currentPrincipal" class="text-2xl font-bold text-green-600">$0.00</p>
                        </div>
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <p class="text-sm text-gray-600">Interest This Month</p>
                            <p id="currentInterest" class="text-2xl font-bold text-red-600">$0.00</p>
                        </div>
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <p class="text-sm text-gray-600">Remaining Balance</p>
                            <p id="currentBalance" class="text-2xl font-bold text-gray-800">$0.00</p>
                        </div>
                    </div>
                     <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 text-center mt-4">
                        <div class="bg-blue-50 p-4 rounded-lg">
                            <p class="text-sm text-gray-600">Cumulative Principal Paid</p>
                            <p id="totalPrincipal" class="text-2xl font-bold text-blue-800">$0.00</p>
                        </div>
                        <div class="bg-red-50 p-4 rounded-lg">
                            <p class="text-sm text-gray-600">Cumulative Interest Paid</p>
                            <p id="totalInterest" class="text-2xl font-bold text-red-800">$0.00</p>
                        </div>
                    </div>
                </div>

                <!-- Amortization Schedule Content Panel -->
                <div id="scheduleContent" class="tab-content hidden">
                    <div class="card">
                        <div id="amortization-table-container" class="h-96 overflow-y-auto border border-gray-200 rounded-lg">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50 sticky top-0">
                                    <tr>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Pmt #</th>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Principal</th>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Interest</th>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Balance</th>
                                    </tr>
                                </thead>
                                <tbody id="amortization-body" class="bg-white divide-y divide-gray-200">
                                   <!-- Rows will be generated by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- DOM Elements ---
        const loanAmountEl = document.getElementById('loanAmount');
        const interestRateEl = document.getElementById('interestRate');
        const loanTermEl = document.getElementById('loanTerm');
        const calculateBtn = document.getElementById('calculateBtn');
        const amortizationBody = document.getElementById('amortization-body');
        const sliderContainer = document.getElementById('slider-container');
        const paymentSlider = document.getElementById('paymentSlider');
        const sliderValueEl = document.getElementById('sliderValue');
        const chartCanvas = document.getElementById('payoffChart');
        // Summary Elements
        const monthlyPaymentEl = document.getElementById('monthlyPayment');
        const totalPrincipalEl = document.getElementById('totalPrincipal');
        const totalInterestEl = document.getElementById('totalInterest');
        const currentPrincipalEl = document.getElementById('currentPrincipal');
        const currentInterestEl = document.getElementById('currentInterest');
        const currentBalanceEl = document.getElementById('currentBalance');
        // Tab Elements
        const resultsTabBtn = document.getElementById('resultsTabBtn');
        const scheduleTabBtn = document.getElementById('scheduleTabBtn');
        const resultsContent = document.getElementById('resultsContent');
        const scheduleContent = document.getElementById('scheduleContent');

        let amortizationSchedule = [];
        let payoffChart;

        // --- Chart Configuration ---
        const chartConfig = {
            type: 'doughnut', // Changed from 'pie'
            data: {
                labels: ['Principal This Month', 'Interest This Month'],
                datasets: [{
                    data: [1, 0],
                    backgroundColor: ['#2563eb', '#ef4444'], // Blue-600, Red-500
                    borderColor: '#f8f9fa', // Match body background
                    borderWidth: 4,
                    cutout: '60%', // Makes it a donut chart
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                animation: {
                    duration: 0 
                },
                plugins: {
                    legend: { position: 'bottom', labels: { padding: 20, usePointStyle: true, pointStyle: 'circle', font: { size: 12, family: 'Inter' } } },
                    tooltip: {
                        callbacks: {
                            label: (context) => `${context.label || ''}: ${formatCurrency(context.parsed)}`
                        }
                    }
                }
            }
        };

        // --- Core Functions ---
        function calculateMonthlyPayment(principal, annualRate, termYears) {
            const monthlyRate = annualRate / 100 / 12;
            const numberOfPayments = termYears * 12;
            if (monthlyRate === 0) return principal / numberOfPayments;
            return principal * (monthlyRate * Math.pow(1 + monthlyRate, numberOfPayments)) / (Math.pow(1 + monthlyRate, numberOfPayments) - 1);
        }

        function generateAmortizationSchedule() {
            amortizationSchedule = [];
            amortizationBody.innerHTML = '';
            
            const principal = parseFloat(loanAmountEl.value);
            const annualRate = parseFloat(interestRateEl.value);
            const termYears = parseInt(loanTermEl.value);

            if (isNaN(principal) || isNaN(annualRate) || isNaN(termYears) || principal <= 0 || annualRate < 0 || termYears <= 0) {
                const messageBox = document.createElement('div');
                messageBox.textContent = "Please enter valid loan details.";
                messageBox.style.cssText = "position:fixed; top:20px; left:50%; transform:translateX(-50%); background-color: #f8d7da; color: #721c24; padding: 1rem; border-radius: 0.5rem; border: 1px solid #f5c6cb; z-index:1000;";
                document.body.appendChild(messageBox);
                setTimeout(() => messageBox.remove(), 3000);
                return;
            }

            const monthlyPayment = calculateMonthlyPayment(principal, annualRate, termYears);
            const numberOfPayments = termYears * 12;
            const monthlyRate = annualRate / 100 / 12;

            let balance = principal;
            let cumulativeInterest = 0;
            let cumulativePrincipal = 0;

            for (let i = 1; i <= numberOfPayments; i++) {
                const interestForMonth = balance * monthlyRate;
                let principalForMonth = monthlyPayment - interestForMonth;
                if (balance < monthlyPayment) { principalForMonth = balance; }
                balance -= principalForMonth;
                cumulativeInterest += interestForMonth;
                cumulativePrincipal += principalForMonth;
                amortizationSchedule.push({
                    paymentNumber: i,
                    principalPaid: principalForMonth,
                    interestPaid: interestForMonth,
                    remainingBalance: balance < 0 ? 0 : balance,
                    cumulativePrincipal: cumulativePrincipal,
                    cumulativeInterest: cumulativeInterest
                });
            }

            monthlyPaymentEl.textContent = formatCurrency(monthlyPayment);
            
            paymentSlider.max = numberOfPayments;
            paymentSlider.value = 1;
            sliderValueEl.textContent = '1';
            sliderContainer.classList.remove('hidden');

            displayScheduleTable();
            updateVisualization(1);
        }

        function displayScheduleTable() {
            const fragment = document.createDocumentFragment();
            amortizationSchedule.forEach(p => {
                const row = document.createElement('tr');
                row.id = `payment-row-${p.paymentNumber}`;
                row.innerHTML = `
                    <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">${p.paymentNumber}</td>
                    <td class="px-4 py-3 whitespace-nowrap text-sm text-green-600">${formatCurrency(p.principalPaid)}</td>
                    <td class="px-4 py-3 whitespace-nowrap text-sm text-red-600">${formatCurrency(p.interestPaid)}</td>
                    <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-800">${formatCurrency(p.remainingBalance)}</td>
                `;
                fragment.appendChild(row);
            });
            amortizationBody.appendChild(fragment);
        }

        function updateVisualization(paymentNumber) {
            if (!amortizationSchedule.length || paymentNumber < 1) return;
            const currentPayment = amortizationSchedule[paymentNumber - 1];
            if (!currentPayment) return;

            // Update chart data to show the breakdown for the CURRENT month
            payoffChart.data.datasets[0].data[0] = currentPayment.principalPaid;
            payoffChart.data.datasets[0].data[1] = currentPayment.interestPaid;
            payoffChart.update();

            // Update Results tab content
            currentPrincipalEl.textContent = formatCurrency(currentPayment.principalPaid);
            currentInterestEl.textContent = formatCurrency(currentPayment.interestPaid);
            currentBalanceEl.textContent = formatCurrency(currentPayment.remainingBalance);
            totalPrincipalEl.textContent = formatCurrency(currentPayment.cumulativePrincipal);
            totalInterestEl.textContent = formatCurrency(currentPayment.cumulativeInterest);

            // Highlight row in schedule table
            document.querySelectorAll('#amortization-body tr').forEach(row => row.classList.remove('bg-blue-100', 'font-semibold'));
            const currentRow = document.getElementById(`payment-row-${paymentNumber}`);
            if (currentRow) {
                currentRow.classList.add('bg-blue-100', 'font-semibold');
            }
        }

        // --- Helper Functions ---
        function formatCurrency(value) {
            return new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(value);
        }

        function throttle(func, limit) {
            let inThrottle;
            return function() {
                const args = arguments;
                const context = this;
                if (!inThrottle) {
                    func.apply(context, args);
                    inThrottle = true;
                    setTimeout(() => inThrottle = false, limit);
                }
            }
        }

        // --- Event Listeners ---
        calculateBtn.addEventListener('click', generateAmortizationSchedule);
        
        const throttledUpdate = throttle(updateVisualization, 50);

        paymentSlider.addEventListener('input', (e) => {
            const paymentNumber = parseInt(e.target.value);
            sliderValueEl.textContent = paymentNumber;
            throttledUpdate(paymentNumber);
        });

        const inputsToFix = [loanAmountEl, interestRateEl, loanTermEl];
        inputsToFix.forEach(input => {
            input.addEventListener('focus', (e) => {
                const value = e.target.value;
                e.target.value = '';
                e.target.value = value;
            });
        });

        // Tab switching logic
        resultsTabBtn.addEventListener('click', () => {
            resultsContent.classList.remove('hidden');
            scheduleContent.classList.add('hidden');
            resultsTabBtn.className = "whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm border-blue-500 text-blue-600";
            scheduleTabBtn.className = "whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300";
        });

        scheduleTabBtn.addEventListener('click', () => {
            scheduleContent.classList.remove('hidden');
            resultsContent.classList.add('hidden');
            scheduleTabBtn.className = "whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm border-blue-500 text-blue-600";
            resultsTabBtn.className = "whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300";
        });

        // --- Initial Setup ---
        window.onload = () => {
            payoffChart = new Chart(chartCanvas, chartConfig);
            generateAmortizationSchedule();
        };
    </script>

</body>
</html>
